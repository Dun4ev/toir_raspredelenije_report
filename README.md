# Скрипт `toir_raspredelenije.py`

## 1. Назначение

Скрипт автоматизирует процесс сортировки и архивации файлов отчетов на основе информации, извлеченной из их имен. На данный момент он предназначен для работы только с "Basic" отчетами (содержащими `-B-` в имени), имеющими строго определенный формат, например `CT-DR-B-LP-BVS12-..._All.pdf`.

## 2. Принцип работы

1.  **Поиск:** Скрипт сканирует подпапки в `INBOX_DIR`, ища в каждой уникальный `.pdf` файл отчета, имя которого содержит `_All` и соответствует заданному шаблону.
2.  **Анализ:** Из имени файла извлекаются подробные метаданные: дисциплина (`LP` или `CS`), имя объекта, индекс ТЗ, дата и т.д.
3.  **Распределение:** Скрипт применяет правила в следующем порядке:
    *   **Корректирующее обслуживание (`-C-`):** Если отчет является корректирующим (содержит `-C-` в поле периода), он помещается в специальную папку `Корректирующее ослуживание`, игнорируя объект или индекс ТЗ.
    *   **Периодическое обслуживание (остальные):** Если отчет не является корректирующим, применяются следующие правила:
        *   **Для `LP` (Line Pipe):** Файлы распределяются по папкам, названным в соответствии с **именем объекта** (например, `.../LP/pdf/BVS5/`).
        *   **Для `CS` (Compressor Station):** Скрипт использует **индекс ТЗ** из имени файла (например, `II.12`), находит по этому индексу папку и распределяет файлы в нее.
4.  **Копирование и архивация:**
    *   Файл отчета копируется в несколько папок назначения, включая `NOTES_DIR` и `TRA_GST_DIR` (в последней используется логика недельных папок).
    *   Исходная папка проекта полностью архивируется в `.zip` архив.
    *   Созданный архив перемещается в целевую структуру папок `Native`, перезаписывая существующий, если он там уже есть.

## 3. Требования и структура проекта

- **Python**: Версия 3.8 или новее.
- **Структура папок**: Все пути к папкам (`INBOX_DIR`, `NOTES_DIR` и т.д.) жестко прописаны в самом скрипте. Перед использованием их необходимо проверить и при необходимости отредактировать. Скрипт может находиться в своей собственной папке.

  ```
  .../toir_raspredelenije/
  ├── toir_raspredelenije.py   # Сам скрипт
  ├── toir_raspredelenije.md   # Этот файл
  └── test/                    # Папка с тестовыми данными, на которую указывают пути в скрипте
      └── ...
  ```

## 4. Использование

1.  Откройте файл `toir_raspredelenije.py` в текстовом редакторе.
2.  В секции `=== НАСТРОЙКИ ПУТЕЙ ===` укажите правильные пути к вашим рабочим папкам.
3.  Запустите скрипт: `python toir_raspredelenije.py`.
4.  Скрипт автоматически обработает все подпапки в `INBOX_DIR`.

## 5. Структура имени файла

Имя файла имеет строгий формат и разбивается на компоненты, которые используются для сортировки.

Пример: `CT-DR-B-LP-BVS5-I.7.4-00-1G-20250825-00_All.pdf`

- `CT`: Компания
- `DR`: Тип документа
- `B`: Объем работ
- `LP`: Дисциплина (`LP` или `CS`)
- `BVS5`: Имя объекта (для `LP`)
- `I.7.4`: Индекс ТЗ (для `CS`)
- `20250825`: Дата
- `00`: Ревизия