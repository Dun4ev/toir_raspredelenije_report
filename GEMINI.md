# Проект GEMINI: toir_raspredelenije_report

## Обзор проекта

Этот проект состоит из одного скрипта на Python, `toir_raspredelenije.py`, предназначенного для автоматизации сортировки и архивации файлов отчетов. Скрипт сканирует подпапки в поисках готовых к обработке отчетов, извлекает из их имен подробные метаданные и на их основе распределяет файлы по папкам.

Ключевым триггером для обработки является наличие `_All` в имени файла, что означает, что отчет готов к распределению.

Скрипт написан на Python 3 и использует стандартные библиотеки:

* `itertools`, `json`, `datetime`: Вспомогательные утилиты для работы с итераторами, данными и датами.
* `re`: Для детального разбора имен файлов с помощью регулярных выражений по сложной схеме.
* `shutil`: Для файловых операций (копирование, архивация).
* `pathlib`: Для надежного и кросс-платформенного управления путями.

## Сборка и запуск

### Конфигурация

Перед запуском скрипта необходимо настроить пути в разделе `=== НАСТРОЙКИ ПУТЕЙ ===`. Эти пути определяют, где искать исходные проекты и куда складывать результаты.

### Выполнение

Скрипт не требует сборки. Для запуска выполните команду в терминале:

```bash
python toir_raspredelenije.py
```

Скрипт выведет в консоль подробный лог своих действий, включая все данные, извлеченные из имен файлов.

## Соглашения по разработке

* **Поиск по триггеру:** Скрипт ищет в папках проекты, содержащие уникальный файл `.pdf` или `.docx`, в имени которого есть пометка `_All`.
* **Детальный разбор имени:** Найдя файл, скрипт применяет к его имени сложный шаблон, разбирая его на 10+ компонентов (тип, дисциплина, объект, индекс, дата, ревизия и т.д.).
* **Модульность:** Код организован в функции с четкой зоной ответственности (`process_project_folder`, `copy_to_gst_folder`, `main`).
* **Подробное логирование:** Для легкой отладки скрипт подробно сообщает о каждом шаге и выводит все извлеченные из имени файла данные в удобном формате.
* **Идемпотентность:** Скрипт можно безопасно запускать повторно. Если целевой файл или архив уже существует, он будет **перезаписан**.

---

### Расширенное правило копирования в `04_TRA_GST`

При обработке каждого файла отчета применяется особый алгоритм для его копирования в папку `04_TRA_GST`.

**Цель:** Копировать файлы в папки, сгруппированные по неделям. Если папка за неделю "закрыта" (содержит специальный архив), автоматически создавать папку для следующей недели.

**Алгоритм:**

1. **Определение недели:** Из полной даты в имени файла (например, `20250915`) вычисляется номер недели в году.
2. **Формирование имени папки:** Имя создается по шаблону `[Год]_T[НомерНедели]_GST` (например, `2025_T38_GST`).
3. **Итеративный поиск свободной папки:**
   * Скрипт проверяет папку для вычисленной недели. Если она "закрыта" (содержит архив `CT-GST-TRA-PRM-*`), он увеличивает номер недели на 1 и проверяет следующую (`2025_T39_GST`).
   * Цикл продолжается, пока не будет найдена "свободная" папка (которая либо не существует, либо не содержит закрывающего архива).
   * Файл отчета копируется в найденную свободную папку.
