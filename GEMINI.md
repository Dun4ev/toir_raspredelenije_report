# Проект GEMINI: toir_raspredelenije_report

## Обзор проекта

Этот проект состоит из одного скрипта на Python, `toir_raspredelenije.py`, предназначенного для автоматизации сортировки и архивации файлов отчетов. Скрипт обрабатывает файлы из входного каталога, извлекает метаданные (год, месяц, тип и имя объекта) из их имен с помощью регулярных выражений, а затем копирует и архивирует их в структурированную иерархию каталогов.

Скрипт написан на Python 3 и использует стандартные библиотеки:

*   `re`: Для разбора имен файлов с помощью регулярных выражений.
*   `shutil`: Для файловых операций, таких как копирование и архивирование.
*   `pathlib`: Для надежного и кросс-платформенного управления путями.
*   `sys`: Для настройки кодировки вывода в консоли.

Скрипт предназначен для ручного запуска и требует настройки путей ввода и вывода перед выполнением.

## Сборка и запуск

### Конфигурация

Перед запуском скрипта необходимо настроить пути в разделе `=== НАСТРОЙКИ ПУТЕЙ ===` файла `toir_raspredelenije.py`. Эти пути определяют исходный каталог для отчетов, каталоги назначения для отсортированных файлов и архивов, а также временный каталог для создания архивов.

### Выполнение

Скрипт не требует процесса сборки. Чтобы запустить скрипт, выполните следующую команду в вашем терминале:

```bash
python toir_raspredelenije.py
```

Скрипт будет выводить в консоль информацию о своем прогрессе, указывая, какие файлы обрабатываются, какие данные извлекаются и результаты файловых операций.

## Соглашения по разработке

*   **Управление путями:** Скрипт использует библиотеку `pathlib` для всех путей файловой системы, что обеспечивает совместимость между различными операционными системами.
*   **Конфигурация:** Все настраиваемые параметры, такие как пути к файлам и регулярное выражение для разбора имен файлов, сгруппированы в начале скрипта для удобства изменения.
*   **Модульность:** Код организован в функции с определенными обязанностями (`process_project_folder`, `normalize_object_name`, `main`), что улучшает читаемость и поддерживаемость.
*   **Логирование:** Скрипт предоставляет подробную обратную связь о своих операциях, выводя в консоль статусные сообщения, предупреждения и ошибки. Это полезно для отладки и мониторинга выполнения скрипта.
*   **Обработка ошибок:** Скрипт включает базовую обработку ошибок с использованием блоков `try...except` для перехвата и сообщения об исключениях во время файловых операций, что предотвращает неожиданное завершение работы скрипта.

---

### Расширенное правило копирования в `04_TRA_GST`

При обработке каждого файла `*_All.pdf` будет применяться особый алгоритм для его копирования в папку `04_TRA_GST`.

**Цель:** Копировать файлы в папки, сгруппированные по неделям. Если папка за неделю "закрыта" (содержит специальный архив), автоматически создавать папку для следующей недели.

**Алгоритм:**

1.  **Определение базового имени папки:**
    *   Из имени PDF-файла извлекается **год**.
    *   Определяется **текущий номер недели** в году (например, `37`).
    *   Формируется имя целевой папки по шаблону: `[Год]_T[НомерНедели]_GST`.
    *   *Пример: `2025_T37_GST`.*

2.  **Итеративный поиск свободной папки:**
    *   Скрипт начинает проверку с папки для текущей недели (например, `2025_T37_GST`).
    *   **Проверка 1: Существует ли папка?**
        *   Если папка (например, `.../04_TRA_GST/2025_T37_GST`) **не существует**, она считается "свободной". Скрипт создаст ее и скопирует туда `*_All.pdf` файл. На этом процесс для данного файла завершается.
        *   Если папка **существует**, скрипт переходит к Проверке 2.
    *   **Проверка 2: "Закрыта" ли папка?**
        *   Скрипт проверяет, есть ли внутри этой папки (`2025_T37_GST`) хотя бы один архив (`.zip`, `.7z`, `.rar`), в имени которого содержится текст `CT-GST-TRA-PRM-`.
        *   Если такого архива **нет**, папка считается "свободной". Скрипт скопирует `*_All.pdf` файл в нее. На этом процесс завершается.
        *   Если такой архив **есть**, папка считается "закрытой". Скрипт увеличивает номер недели на 1 (37 → 38) и **повторяет весь процесс заново** уже для папки `2025_T38_GST`.

3.  **Цикл продолжается** до тех пор, пока не будет найдена "свободная" папка для копирования.
