# Repository Guidelines

## Project Structure & Module Organization
Основной код сосредоточен в `toir_raspredelenije.py`, который управляет разбором и раскладкой производственных PDF. Настроечный шаблон хранится в `Template/TZ_glob.xlsx`, а результаты и промежуточные выгрузки складываются по месяцам в `2025/<месяц>/{CS,LP}`. Каталог `templates/` резервируем под образцы тестовых входных файлов; не кладите туда реальные архивы. Локальное виртуальное окружение держите в `.venv` и исключайте из коммитов. Для тестов заведите одноимённую директорию `tests/`, разделяя unit- и интеграционные сценарии. Пример структуры:
```
repo/
├─ toir_raspredelenije.py
├─ Template/TZ_glob.xlsx
├─ 2025/08.August/{CS,LP}
└─ templates/
```

## Build, Test, and Development Commands
- `python -m venv .venv` и `.venv\Scripts\activate` — подготовка окружения.
- `pip install --upgrade pip` и `pip install openpyxl pytest ruff black` — базовый стек; фиксируйте зависимости через `pip-compile requirements.in`.
- `python toir_raspredelenije.py` — запуск полного цикла; перед выполнением убедитесь, что пути в начале файла указывают на тестовый стенд.
- `pytest -q` — быстрый регресс; добавляйте целевые запуски вроде `pytest tests/test_pipeline.py -k smoke` для специфичных кейсов.

## Coding Style & Naming Conventions
Используем Python ≥3.10, отступы 4 пробела, строки до 100 символов. Все функции и публичные классы сопровождаем тайпингом и докстрингами на русском. Форматирование держим через `black`, статический анализ через `ruff` (`ruff check --fix`) и `mypy --strict`. Имена модулей — snake_case, константы верхним регистром, фабрики и хелперы prefix `build_`/`make_`.

## Testing Guidelines
Покрываем новую логику unit-тестами, критический парсинг — интеграционными тестами с фиктивными PDF в `templates/fixtures`. Файлы тестов именуем `test_<feature>.py`, сценарии — `test_should_<result>`. Требуемый минимум покрытия — 80% по веткам для модуля после изменения. Для тяжёлых сценариев используйте маркировку `@pytest.mark.slow` и выносите в отдельный CI-джоб.

## Commit & Pull Request Guidelines
Коммиты пишем в императиве и по шаблону `type: краткое действие` (напр., `fix: обновить фильтр участков`). В теле — мотивация, риски и инструкции по проверке. Пул-реквест сопровождаем чеклистом: ссылка на задачу, скриншоты/лог команд (если есть визуальный результат), список проверок (`ruff`, `black --check`, `pytest -q`). Не сливаем, пока не подтверждена корректность путей на тестовом стенде.

## Security & Configuration Tips
Не хардкодьте промышленные пути: переносите значения `INBOX_DIR` и соседних констант в `.env` и загружайте через `os.getenv`. Личные данные и архивы не храните в репозитории. Перед запуском проверяйте права на каталоги назначения и используйте отдельные тестовые копии PDF, чтобы исключить перезапись боевых артефактов.
